# HG changeset patch
# Parent ee1786d10b16b7a447d8dabae18174f668ce7d48
# User Anant Narayanan <anant@kix.in>
XPCOM interface for nsIMediaEngine

diff --git a/dom/Makefile.in b/dom/Makefile.in
--- a/dom/Makefile.in
+++ b/dom/Makefile.in
@@ -67,16 +67,17 @@ DIRS = \
   interfaces/geolocation \
   interfaces/notification \
   interfaces/svg \
   interfaces/smil \
   $(NULL)
 
 DIRS += \
   interfaces/apps \
+  interfaces/media \
   $(NULL)
 
 DIRS += \
   base \
   bindings \
   battery \
   contacts \
   power \
diff --git a/dom/interfaces/media/Makefile.in b/dom/interfaces/media/Makefile.in
new file mode 100644
--- /dev/null
+++ b/dom/interfaces/media/Makefile.in
@@ -0,0 +1,20 @@
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this file,
+# You can obtain one at http://mozilla.org/MPL/2.0/.
+
+DEPTH          = ../../..
+topsrcdir      = @top_srcdir@
+srcdir         = @srcdir@
+VPATH          = @srcdir@
+
+include $(DEPTH)/config/autoconf.mk
+
+MODULE         = dom
+XPIDL_MODULE   = dom_media
+GRE_MODULE     = 1
+
+XPIDLSRCS = \
+            nsIMediaEngine.idl \
+            $(NULL)
+
+include $(topsrcdir)/config/rules.mk
\ No newline at end of file
diff --git a/dom/interfaces/media/nsIMediaEngine.idl b/dom/interfaces/media/nsIMediaEngine.idl
new file mode 100644
--- /dev/null
+++ b/dom/interfaces/media/nsIMediaEngine.idl
@@ -0,0 +1,136 @@
+/* This Source Code Form is subject to the terms of the Mozilla Public
+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,
+ * You can obtain one at http://mozilla.org/MPL/2.0/.
+ */
+
+#include "nsISupports.idl"
+
+[scriptable, uuid(35c2d704-dc5e-4de1-a7ac-002662626347)]
+interface nsIMediaEngineError : nsISupports
+{
+  const unsigned short UNKNOWN_ERROR = 0;
+  readonly attribute short code;
+};
+
+[scriptable, function, uuid(2c0b7d34-d74a-4bad-94c1-5d2dda32a26e)]
+interface nsIMediaEngineErrorCallback : nsISupports
+{
+  void onError(in nsIMediaEngineError error);  
+};
+
+[scriptable, function, uuid(1a76645c-dee8-415a-b623-3900251b2dfb)]
+interface nsIMediaSourceSuccessCallback : nsISupports
+{
+  void onSuccess(in jsval caps);  
+};
+
+[scriptable, function, uuid(76d68404-daf7-4755-8073-0cf2abbf30c1)]
+interface nsIMediaSourceDeviceSuccessCallback : nsISupports
+{
+  void onSuccess();  
+};
+
+[scriptable, uuid(e9f89c36-5eb1-4b67-96a8-289e64a47456)]
+interface nsIMediaSource : nsISupports
+{
+  readonly attribute string name;
+  readonly attribute string uuid;
+
+  void getCapabilities(
+    in nsIMediaSourceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+
+  void setCapabilities(
+    in jsval caps,
+    in nsIMediaSourceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+
+  void allocate(
+    in nsIMediaSourceDeviceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+
+  void stop(
+    in nsIMediaSourceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+
+  void release(
+    in nsIMediaSourceDeviceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+};
+
+[scriptable, uuid(891401ad-c6cf-4192-93ce-72b855570033)]
+interface nsIMediaVideoStream : nsISupports
+{
+};
+
+[scriptable, function, uuid(ffa40e1b-0a84-4eb7-bf5f-c8f7ead8d7e8)]
+interface nsIMediaVideoSourceSuccessCallback : nsISupports
+{
+  void onSuccess(in nsIMediaVideoStream stream);  
+};
+
+[scriptable, uuid(a90fa8fe-b102-4c30-96f4-3a28f38a173f)]
+interface nsIMediaVideoSource : nsIMediaSource
+{
+  void start(
+    in nsIMediaVideoSourceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+};
+
+[scriptable, uuid(ea143087-8332-4438-af7b-ccc24a840976)]
+interface nsIMediaAudioStream : nsISupports
+{
+};
+
+[scriptable, function, uuid(d4466013-c92e-4471-b4b1-5e82d73657a6)]
+interface nsIMediaAudioSourceSuccessCallback : nsISupports
+{
+  void onSuccess(in nsIMediaAudioStream stream);  
+};
+
+[scriptable, uuid(ab41e297-e9e4-4c59-a0a4-e19a4a029a53)]
+interface nsIMediaAudioSource : nsIMediaSource
+{
+  void start(
+    in nsIMediaAudioSourceSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+};
+
+[scriptable, function, uuid(b663f3d4-df40-45ec-8bc3-a0e57509d044)]
+interface nsIMediaVideoEngineSuccessCallback : nsISupports
+{
+  void onSuccess(
+    [array, size_is(len)] in nsIMediaVideoSource sources,
+    in unsigned long len
+  );
+};
+
+[scriptable, function, uuid(a26a995f-9c93-4cca-ab13-289c8F63acbf)]
+interface nsIMediaAudioEngineSuccessCallback : nsISupports
+{
+  void onSuccess(
+    [array, size_is(len)] in nsIMediaAudioSource sources,
+    in unsigned long len
+  );
+};
+
+[scriptable, uuid(5d59a90c-b780-4301-8cab-d8025178f9a2)]
+interface nsIMediaEngine : nsISupports
+{
+  void enumerateVideoDevices(
+    in nsIMediaVideoEngineSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+
+  void enumerateAudioDevices(
+    in nsIMediaAudioEngineSuccessCallback success,
+    in nsIMediaEngineErrorCallback error
+  );
+};
\ No newline at end of file
